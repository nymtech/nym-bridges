#!/bin/sh
set -e

BRIDGES_CONF="/etc/nym/bridges.toml"

remove_firewall_rule() {
    # Remove the nym-bridge firewall rule
    if command -v ufw >/dev/null 2>&1; then
        ufw delete allow 4443/udp 2>/dev/null || true
    fi
}

case "$1" in
remove|purge)
    # Remove firewall rule on both remove and purge
    remove_firewall_rule
    
    # Only remove config files on purge
    if [ "$1" = "purge" ]; then
        # Per https://www.debian.org/doc/debian-policy/ch-files.html#behavior
        # "configuration files must be preserved when the package is removed, and
        #  only deleted when the package is purged."
        if [ -f ${BRIDGES_CONF} ]; then
            rm ${BRIDGES_CONF}
        fi
        # Also remove client bridge params if it exists
        if [ -f "/etc/nym/client_bridge_params.json" ]; then
            rm "/etc/nym/client_bridge_params.json"
        fi
        # Remove keys directory if it exists
        if [ -d "/etc/nym/keys" ]; then
            rm -rf "/etc/nym/keys"
        fi
    fi
    ;;
esac

#DEBHELPER#